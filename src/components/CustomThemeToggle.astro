---
/**
 * Single-click dark/light mode toggle.
 * Shows a sun icon in dark mode (click → switch to light)
 * and a moon icon in light mode (click → switch to dark).
 * Reads/writes localStorage key "starlight-theme" (Starlight compatible).
 */
---

<button
  id="theme-toggle"
  class="theme-toggle"
  aria-label="Toggle theme"
  title="Toggle theme"
  data-theme="dark"
>
  <!-- Sun — shown when current theme is dark (click to go light) -->
  <svg
    class="icon-sun"
    xmlns="http://www.w3.org/2000/svg"
    width="18"
    height="18"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    stroke-width="2"
    stroke-linecap="round"
    stroke-linejoin="round"
    aria-hidden="true"
  >
    <circle cx="12" cy="12" r="4"/>
    <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41
             M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"/>
  </svg>

  <!-- Moon — shown when current theme is light (click to go dark) -->
  <svg
    class="icon-moon"
    xmlns="http://www.w3.org/2000/svg"
    width="18"
    height="18"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    stroke-width="2"
    stroke-linecap="round"
    stroke-linejoin="round"
    aria-hidden="true"
  >
    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
  </svg>
</button>

<style>
  .theme-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2rem;
    height: 2rem;
    padding: 0;
    border: none;
    border-radius: 0.375rem;
    background: transparent;
    color: var(--sl-color-gray-2);
    cursor: pointer;
    transition: color 0.2s ease, background-color 0.2s ease;
  }

  .theme-toggle:hover {
    color: var(--sl-color-white);
    background-color: hsla(0, 0%, 50%, 0.15);
  }

  /* Hide/show icons based on data-theme attribute */
  .theme-toggle[data-theme="dark"] .icon-sun  { display: block; }
  .theme-toggle[data-theme="dark"] .icon-moon { display: none;  }
  .theme-toggle[data-theme="light"] .icon-sun  { display: none;  }
  .theme-toggle[data-theme="light"] .icon-moon { display: block; }
</style>

<script>
  (function () {
    const btn = document.getElementById('theme-toggle') as HTMLButtonElement | null;
    if (!btn) return;

    // Read Starlight's localStorage key
    const STORAGE_KEY = 'starlight-theme';

    function resolveTheme(): 'dark' | 'light' {
      const stored = localStorage.getItem(STORAGE_KEY);
      if (stored === 'dark' || stored === 'light') return stored;
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }

    function applyTheme(theme: 'dark' | 'light') {
      document.documentElement.dataset.theme = theme;
      localStorage.setItem(STORAGE_KEY, theme);
      btn!.dataset.theme = theme;
      btn!.setAttribute('aria-label', theme === 'dark' ? 'Switch to light mode' : 'Switch to dark mode');
      btn!.setAttribute('title',      theme === 'dark' ? 'Switch to light mode' : 'Switch to dark mode');
    }

    // Initialise on load
    applyTheme(resolveTheme());

    btn.addEventListener('click', () => {
      applyTheme(resolveTheme() === 'dark' ? 'light' : 'dark');
    });

    // React to system preference changes (only when no stored preference)
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
      if (!localStorage.getItem(STORAGE_KEY)) {
        applyTheme(e.matches ? 'dark' : 'light');
      }
    });
  })();
</script>
